<html>

<link href='http://fonts.googleapis.com/css?family=Ultra|Vidaloka' rel='stylesheet' type='text/css'>
<style>
body {
	background-color: #1A1A1A;
	color: #fff;
	}
h1, h2 {
	text-align: center;
	}
h1 {
	font-family: 'Ultra', serif;
	margin-bottom: 0
	}
h2 {
	font-family: 'Vidaloka', serif;
	margin-top: 5px;	
	}
p {
	font-size: 20px;
	}
ul {
	list-style-type: none;
	}
.article {
	width: 1280px;
	margin: 20px auto;
	background-color: #000;
	padding: 10px;
	}
.byline {
	color: #787878;
	text-transform:uppercase;
	font-size: 12px;
	}	
a.readmore {
	color: #787878;
	text-transform:uppercase;
	font-size: 75%
	}
a.readmore:hover {
	color: yellow;
	}
.loading {
	  background: url('ajax-loader.gif') no-repeat center center;
	  height: 66px;
	  width: 1280px;
	}
.hideimage {
	display: none;
	}
.showimage {
	display: block;
	margin: 0 auto;
	width: 1280px;
}
</style>

<body>

	<h1>NYTimes Big Picture</h1>
	<h2>A TimesOpen Hack by Tobias Wright</h2>

	<ul id="content"></ul>
	
	<a href="https://github.com/tobiaswright/nyt-viewer"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<script>
//proxy script for nyt json result
var nykey = "nytfeed.php";

var buildImage = function(reseultURL) {
	var j = 0,
		newPathname = "";

	imgurl = reseultURL.url;
	imgurl = imgurl.split('/');
	imgurl.splice(imgurl.length-1, 2);

	for ( j = 0; j < imgurl.length; j++ ) {

		if (j === imgurl.length-1){
			newPathname += imgurl[j];
			newPathname += "/";
			newPathname += imgurl[j];
			newPathname += "-superjumbo.jpg"
		} else {							
			newPathname += imgurl[j];
			newPathname += "/";							
		}
	}

	return newPathname;
}


$().ready(function(){
	$.getJSON( nykey , function(data) {
		//console.log(data)

		$.each(data.results, function(i){
			var imgurl,
				newPathname,
				imgcontent = "",
				result = data.results[i];
			
			if (
				result.media !== '' &&
				result.section !== "Opinion" &&
				typeof result.media[0]["media-metadata"][1] !== "undefined" &&
				typeof result.media !== "undefined"
			)
			{	

				newPathname = buildImage(result.media[0]["media-metadata"][1]);
						

				imgcontent = "<li class='article'>";
				imgcontent += "<p class='byline'>" + result.section + "</p>";
				
				imgcontent += "<div id='imgdiv"+i+"' class='loading'>";
				imgcontent += "<img class='hideimage' src='" + newPathname + "' id='jumbo" +i+ "'>";
				imgcontent += "</div>";
				
				imgcontent += "<p><strong>" + result.title + ".</strong> ";
				imgcontent += result.abstract + " ";
				imgcontent += "<a href='" + result.url + "' class='readmore'>Read Story</a></p>";
				imgcontent += "<p class='byline'>" + result.byline
				//if (data.results[i].media[0].copyright) {"/ Photo Credit: " + data.results[i].media[0].copyright + "</p>"};
				imgcontent += "</li>";
				
				$( imgcontent ).appendTo("#content");
						
			}


			$('#jumbo'+i).load(function() {
				
				//centers images less then the 1024px, the common size for nyt jumbo sizes - usually a portrait
				var img_width = this.width;
				
				//wanted a nice fade in despite loading time
				setTimeout (function () {
					$("#imgdiv"+i).removeClass("loading");
					$("#jumbo"+i).fadeIn("slow").removeClass("hideimage").addClass("showImage");

					if (img_width < 1280) {
						$('#jumbo'+i).css({"width":img_width,"display":"block"})
					}

				}, 3000);
			});		
		});
	});
});

</script>
</body>
</html>